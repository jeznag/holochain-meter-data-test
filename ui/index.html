<html>
  <head>
    <script type="text/javascript" src="/meterData.js"></script>
    <script type="text/javascript" src="/chart.js"></script>
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
  </head>
  <body>
    <h1>Top Buildings</h1>
    <table id="buildingRankTable">
      <thead>
        <tr>
          <th>Building</th>
          <th>Average electricity cost per sq. meter per day</th>
          <th>Average Occupant Comfort Rating</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>

    <div id='chart'>
    </div>

    <script type="text/javascript">
      const BUILDING_NAMES = {
        '1': '44 Blackburn St',
        '2': '52 Harrington Rd',
        '3': '27 Northborne St',
        '4': '13 Waterbird Avenue',
        '5': '8 George Street',
        '6': '15 Collingwood Avenue'
      }
      meterDataRead((rawData) => {
        const processedData = processData(rawData);
        const dataForChart = Object.entries(processedData).map(([buildingID, data]) => {
          return {
            text: BUILDING_NAMES[buildingID],
            values: data.data.map((datum) => datum.power_consumed_kwh)
          };
        });
        renderChart(dataForChart);
        const buildingsRankedByElectricityUsage = Object.keys(processedData).slice().sort((a, b) => {
          return processedData[a].averageUsagePerDay - processedData[b].averageUsagePerDay;
        });
        const tableBodyEl = document.querySelector('#buildingRankTable tbody');
        buildingsRankedByElectricityUsage.forEach((buildingID) => {
          const buildingData = processedData[buildingID];
          tableBodyEl.innerHTML += `<tr>
            <td>${BUILDING_NAMES[buildingID]}</td>
            <td>${buildingData.averageSpendPerDay}</td>
            <td>TODO</td>
          </tr>`;
        });
      });
    </script>
  </body>
</html>
